/*!
 * AetherCipher v1.0.0
 * 
 * [AetherCipher]{@link https://placeholder.com}
 *
 * @version 1.0.0
 * @author msentimental
 * @copyright Strike Bot Inc. 2026
 * @license UNLICENSED - All Rights Reserved
 * 
 * IMPORTANT: This software is proprietary and confidential.
 * Unauthorized copying, modification, distribution, or use
 * is strictly prohibited without written permission.
 * 
 * Contact: lijinhan2025@gmail.com for licensing inquiries.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AetherCipher=t()}(this,(function(){"use strict";class AetherCipher{constructor(e){if(!e||"string"!=typeof e)throw new Error("AetherCipher: Key must be a non-empty string");this.blockSize=16,this.halfSize=8,this.rounds=16,this.masterKey=this._hashTo256(e),this._initKeySchedule()}_hashTo256(e){const t=String(e);let n=new Uint32Array(8);n[0]=0x6a09e667,n[1]=0xbb67ae85,n[2]=0x3c6ef372,n[3]=0xa54ff53a,n[4]=0x510e527f,n[5]=0x9b05688c,n[6]=0x1f83d9ab,n[7]=0x5be0cd19;for(let e=0;e<t.length;e++){let r=t.charCodeAt(e);for(let e=0;e<8;e++)n[e]^=(r<<3*e)|r>>5-e,n[e]=(0|n[e]*0x9e3779b9)>>>0,n[e]^=n[3&e+3]^n[7&e+7]}let r=new Uint8Array(32);for(let e=0;e<8;e++)r[4*e]=n[e]>>24&255,r[4*e+1]=n[e]>>16&255,r[4*e+2]=n[e]>>8&255,r[4*e+3]=255&n[e];return r}_initKeySchedule(){let e=new Uint8Array(16*this.rounds),t=0;for(let n=0;n<32;n++)t^=this.masterKey[n]<<8*(n%4);const n=this._chaoticRng(t);for(let t=0;t<e.length;t++)e[t]=Math.floor(256*n());for(let t=0;t<32;t++)e[t]^=this.masterKey[t],e[e.length-1-t]^=this.masterKey[t];this.roundKeys=[];for(let t=0;t<this.rounds;t++)this.roundKeys.push(e.slice(8*t,8*(t+1)));this.sboxes=[];for(let e=0;e<8;e++){let t=new Uint8Array(256);for(let n=0;n<256;n++){let r=n;r^=this.masterKey[(e+n)%32],r=(r<<5|r>>3)&255,r=255&r+Math.floor(256*(.5*Math.sin(n*e)+.5)),t[n]=r}this._makePermutation(t),this.sboxes.push(t)}this.invSboxes=[];for(let e=0;e<8;e++){let t=new Uint8Array(256);for(let n=0;n<256;n++)t[this.sboxes[e][n]]=n;this.invSboxes.push(t)}}_makePermutation(e){let t=new Array(256).fill(!1);for(let n=0;n<256;n++){for(;t[e[n]];)e[n]=255&e[n]+1;t[e[n]]=!0}}_chaoticRng(e){return function(){return e=(0|1664525*e+1013904223)>>>0,(16777215&e)/16777216}}_F(e,t){let n=new Uint8Array(e);for(let e=0;e<8;e++)n[e]^=this.roundKeys[t][e];for(let e=0;e<8;e++){let r=(e+t)%8;n[e]=this.sboxes[r][n[e]]}let r=new Uint8Array(8);for(let e=0;e<8;e++)r[e]=n[(e+t)%8];return r}encryptBlock(e){let t=e.slice(0,8),n=e.slice(8,16);for(let e=0;e<this.rounds;e++){let r=new Uint8Array(8),s=this._F(n,e);for(let e=0;e<8;e++)r[e]=t[e]^s[e];t=n,n=r}let r=new Uint8Array(16);return r.set(t,0),r.set(n,8),r}decryptBlock(e){let t=e.slice(0,8),n=e.slice(8,16);for(let e=this.rounds-1;e>=0;e--){let r=new Uint8Array(8),s=this._F(t,e);for(let e=0;e<8;e++)r[e]=n[e]^s[e];n=t,t=r}let r=new Uint8Array(16);return r.set(t,0),r.set(n,8),r}_entropyFinalizer(e,t){let n=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let s=e[r],o=e[(r+5)%e.length];n[r]=s^(o<<1)^(o>>1)^(255&t)^(r*23)}return n}_pad(e){let t=this.blockSize-e.length%this.blockSize,n=new Uint8Array(e.length+t);n.set(e);for(let r=e.length;r<n.length;r++)n[r]=t;return n}_unpad(e){let t=e[e.length-1];if(t<1||t>this.blockSize)throw new Error("AetherCipher: Invalid padding - possible corruption or wrong key");return e.slice(0,e.length-t)}encrypt(e,t=null){if(!e||"string"!=typeof e)throw new Error("AetherCipher: Plaintext must be a non-empty string");let n=(new TextEncoder).encode(e),r=this._pad(n);let s;if(t&&32===t.length){s=new Uint8Array(16);for(let e=0;e<16;e++){let n=parseInt(t.substr(2*e,2),16);if(isNaN(n))throw new Error("AetherCipher: IV must be a 32-character hex string");s[e]=n}}else s=crypto.getRandomValues(new Uint8Array(16));let o=[],i=s;for(let e=0;e<r.length;e+=16){let t=r.slice(e,e+16);for(let e=0;e<16;e++)t[e]^=i[e];let n=this.encryptBlock(t);o.push(n),i=n}let a=new Uint8Array(s.length+r.length);a.set(s);let l=s.length;for(let e=0;e<o.length;e++){let t=this._entropyFinalizer(o[e],e);a.set(t,l),l+=16}return this._bytesToHex(a)}decrypt(e){if(!e||"string"!=typeof e)throw new Error("AetherCipher: Ciphertext must be a hex string");let t=this._hexToBytes(e);if(t.length<16)throw new Error("AetherCipher: Ciphertext too short - must include IV");let n=t.slice(0,16),r=[];for(let e=16;e<t.length;e+=16)r.push(t.slice(e,e+16));let s=[];for(let e=0;e<r.length;e++){let t=r[e],o=new Uint8Array(16);for(let n=0;n<16;n++){let r=t[n],s=t[(n+5)%16];o[n]=r^(s<<1)^(s>>1)^(255&e)^(n*23)}s.push(o)}let o=[],i=n;for(let e of s){let t=this.decryptBlock(e);for(let e=0;e<16;e++)t[e]^=i[e];o.push(t),i=e}let a=new Uint8Array(16*o.length),l=0;for(let e of o){a.set(e,l),l+=16}let c=this._unpad(a);return(new TextDecoder).decode(c)}_bytesToHex(e){return Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")}_hexToBytes(e){let t=/[^0-9a-fA-F]/g;if(t.test(e))throw new Error("AetherCipher: Invalid hex string - contains non-hex characters");let n=new Uint8Array(e.length/2);for(let t=0;t<e.length;t+=2)n[t/2]=parseInt(e.substr(t,2),16);return n}}return AetherCipher;}));
