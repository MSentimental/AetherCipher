/*!
 * AetherCipher v1.0.6
 * 
 * [AetherCipher - Public]{@link https://cdn.jsdelivr.net/gh/msentimental/AetherCipher@latest/build/aethercipher.min.js}
 *
 * @version 1.0.2
 * @author msentimental [lijinhan2025@gmail.com]
 * @copyright Strike Bot Inc. 2026
 * @license See full license at https://github.com/MSentimental/AetherCipher/blob/main/LICENSE.md
 * 
 * Includes:
 *   - AetherCipher: Reversible encryption (Do not use directly in frontend unless the user is inputting their own master key)
 *   - AetherHash: One-way hashing
 * 
 * [Usage examples]:
 *
 * <script>
 *   // Cipher initialization
 *   const cipher = new AetherCipher('user-key');
 *   const hasher = new AetherHash();
 *   
 *   // Encrypt something
 *   const secret = cipher.encrypt('Hello World!');
 *   console.log('Encrypted:', secret);
 *  
 *   // Hash something
 *   const hash = hasher.hash256('Hello World!');
 *   console.log('Hashed:', hash);
 * </script>
 */

class t{constructor(){this.blockSize=64,this.rounds=80,this.outputSize=64,this._initHashValues()}_initHashValues(){this.h=new Uint32Array(16),this.h[0]=1779033703,this.h[1]=3144134277,this.h[2]=1013904242,this.h[3]=2773480762,this.h[4]=1359893119,this.h[5]=2600822924,this.h[6]=528734635,this.h[7]=1541459225,this.h[8]=-197222434,this.h[9]=626054972,this.h[10]=-1571190069,this.h[11]=997756035,this.h[12]=-818336826,this.h[13]=87167285,this.h[14]=-2118868974,this.h[15]=-975719264}_rotateRight(t,e){return t>>>e|t<<32-e}_rotateLeft(t,e){return t<<e|t>>>32-e}_sigma0(t){return this._rotateRight(t,7)^this._rotateRight(t,18)^t>>>3}_sigma1(t){return this._rotateRight(t,17)^this._rotateRight(t,19)^t>>>10}_pad(t){let e=(new TextEncoder).encode(t),h=8*e.length,r=new Uint8Array(64*((h+8+64)/512+1));r.set(e),r[e.length]=128;for(let t=0;t<8;t++)r[r.length-8+t]=h>>>56-8*t&255;return r}_compress(t){let e=new Uint32Array(80);for(let h=0;h<16;h++)e[h]=t[4*h]<<24|t[4*h+1]<<16|t[4*h+2]<<8|t[4*h+3];for(let t=16;t<80;t++)e[t]=this._sigma1(e[t-2])+e[t-7]+this._sigma0(e[t-15])+e[t-16]>>>0;let h=this.h[0],r=this.h[1],i=this.h[2],s=this.h[3],n=this.h[4],o=this.h[5],l=this.h[6],a=this.h[7],f=this.h[8],u=this.h[9],y=this.h[10],c=this.h[11],p=this.h[12],g=this.h[13],d=this.h[14],w=this.h[15];for(let t=0;t<80;t++){let _=(a+this._rotateRight(n,14)^this._rotateRight(n,18)^this._rotateRight(n,41)+(l^n&(o^l))+e[t]+t)>>>0,A=(this._rotateRight(h,28)^this._rotateRight(h,34)^this._rotateRight(h,39)+(h&r|i&(h|r)))>>>0;w=d,d=g,g=p,p=c,c=y,y=u,u=f,f=a,a=l,l=o,o=n,n=s+_>>>0,s=i,i=r,r=h,h=_+A>>>0}this.h[0]=this.h[0]+h>>>0,this.h[1]=this.h[1]+r>>>0,this.h[2]=this.h[2]+i>>>0,this.h[3]=this.h[3]+s>>>0,this.h[4]=this.h[4]+n>>>0,this.h[5]=this.h[5]+o>>>0,this.h[6]=this.h[6]+l>>>0,this.h[7]=this.h[7]+a>>>0,this.h[8]=this.h[8]+f>>>0,this.h[9]=this.h[9]+u>>>0,this.h[10]=this.h[10]+y>>>0,this.h[11]=this.h[11]+c>>>0,this.h[12]=this.h[12]+p>>>0,this.h[13]=this.h[13]+g>>>0,this.h[14]=this.h[14]+d>>>0,this.h[15]=this.h[15]+w>>>0}hash(t){if(!t||"string"!=typeof t)throw new Error("AetherHash: Input must be a non-empty string");this._initHashValues();let e=this._pad(t);for(let t=0;t<e.length;t+=64)this._compress(e.slice(t,t+64));let h="";for(let t=0;t<16;t++)h+=this.h[t].toString(16).padStart(8,"0");return h.toLowerCase()}hash256(t){return this.hash(t).substring(0,64)}hash512(t){return this.hash(t)}hmac(t,e){let h=128,r=(new TextEncoder).encode(t);r.length>h&&(r=(new TextEncoder).encode(this.hash(t)));let i=new Uint8Array(h),s=new Uint8Array(h);for(let t=0;t<h;t++)i[t]=54,s[t]=92;for(let t=0;t<r.length;t++)i[t]^=r[t],s[t]^=r[t];let n=Array.from(i).map(t=>t.toString(16).padStart(2,"0")).join(""),o=Array.from(s).map(t=>t.toString(16).padStart(2,"0")).join(""),l=this.hash(n+this._strToHex(e));return this.hash(o+l)}_strToHex(t){return Array.from((new TextEncoder).encode(t)).map(t=>t.toString(16).padStart(2,"0")).join("")}}class e{constructor(t){if(!t||"string"!=typeof t)throw new Error("AetherCipher: Key must be a non-empty string");this.blockSize=16,this.halfSize=8,this.rounds=16,this.masterKey=this._hashTo256(t),this._initKeySchedule()}_hashTo256(t){const e=String(t);let h=new Uint32Array(8);h[0]=1779033703,h[1]=3144134277,h[2]=1013904242,h[3]=2773480762,h[4]=1359893119,h[5]=2600822924,h[6]=528734635,h[7]=1541459225;for(let t=0;t<e.length;t++){let r=e.charCodeAt(t);for(let t=0;t<8;t++)h[t]^=r<<3*t|r>>>5-t,h[t]=2654435769*h[t]>>>0,h[t]^=h[t+3&7]^h[t+7&7]}let r=new Uint8Array(32);for(let t=0;t<8;t++)r[4*t]=h[t]>>24&255,r[4*t+1]=h[t]>>16&255,r[4*t+2]=h[t]>>8&255,r[4*t+3]=255&h[t];return r}_initKeySchedule(){let t=new Uint8Array(this.rounds*this.halfSize),e=0;for(let t=0;t<32;t++)e^=this.masterKey[t]<<t%4*8;const h=this._chaoticRng(e);for(let e=0;e<t.length;e++)t[e]=Math.floor(256*h());for(let e=0;e<32;e++)t[e]^=this.masterKey[e],t[t.length-1-e]^=this.masterKey[e];this.roundKeys=[];for(let e=0;e<this.rounds;e++)this.roundKeys.push(t.slice(e*this.halfSize,(e+1)*this.halfSize));this.sboxes=[];for(let t=0;t<8;t++){let e=new Uint8Array(256);for(let h=0;h<256;h++){let r=h;r^=this.masterKey[(t+h)%32],r=255&(r<<5|r>>>3),r=r+Math.floor(256*(.5*Math.sin(h*t)+.5))&255,e[h]=r}this._makePermutation(e),this.sboxes.push(e)}this.invSboxes=[];for(let t=0;t<8;t++){let e=new Uint8Array(256);for(let h=0;h<256;h++)e[this.sboxes[t][h]]=h;this.invSboxes.push(e)}}_makePermutation(t){let e=new Array(256).fill(!1);for(let h=0;h<256;h++){for(;e[t[h]];)t[h]=t[h]+1&255;e[t[h]]=!0}}_chaoticRng(t){return function(){return(16777215&(t=1664525*t+1013904223>>>0))/16777216}}_F(t,e){let h=new Uint8Array(t);for(let t=0;t<8;t++)h[t]^=this.roundKeys[e][t];for(let t=0;t<8;t++){let r=(t+e)%8;h[t]=this.sboxes[r][h[t]]}let r=new Uint8Array(8);for(let t=0;t<8;t++)r[t]=h[(t+e)%8];return r}encryptBlock(t){let e=t.slice(0,8),h=t.slice(8,16);for(let t=0;t<this.rounds;t++){let r=new Uint8Array(8);for(let i=0;i<8;i++)r[i]=e[i]^this._F(h,t)[i];e=h,h=r}let r=new Uint8Array(16);return r.set(e,0),r.set(h,8),r}decryptBlock(t){let e=t.slice(0,8),h=t.slice(8,16);for(let t=this.rounds-1;t>=0;t--){let r=new Uint8Array(8);for(let i=0;i<8;i++)r[i]=h[i]^this._F(e,t)[i];h=e,e=r}let r=new Uint8Array(16);return r.set(e,0),r.set(h,8),r}_pad(t){let e=this.blockSize-t.length%this.blockSize,h=new Uint8Array(t.length+e);h.set(t);for(let r=t.length;r<h.length;r++)h[r]=e;return h}_unpad(t){let e=t[t.length-1];if(e<1||e>this.blockSize)throw new Error("AetherCipher: Invalid padding - wrong key or corrupted data");return t.slice(0,t.length-e)}encrypt(t){if(!t||"string"!=typeof t)throw new Error("AetherCipher: Plaintext must be a non-empty string");let e=(new TextEncoder).encode(t),h=this._pad(e),r=[],i=new Uint8Array(16).fill(0);for(let t=0;t<h.length;t+=16){let e=h.slice(t,t+16);for(let t=0;t<16;t++)e[t]^=i[t];let s=this.encryptBlock(e);r.push(s),i=s}let s=new Uint8Array(h.length),n=0;for(let t of r)s.set(t,n),n+=16;return this._bytesToHex(s)}decrypt(t){if(!t||"string"!=typeof t)throw new Error("AetherCipher: Ciphertext must be a hex string");let e=this._hexToBytes(t);if(e.length<16||e.length%16!=0)throw new Error("AetherCipher: Invalid ciphertext length");let h=[];for(let t=0;t<e.length;t+=16)h.push(e.slice(t,t+16));let r=[],i=new Uint8Array(16).fill(0);for(let t of h){let e=this.decryptBlock(t);for(let t=0;t<16;t++)e[t]^=i[t];r.push(e),i=t}let s=new Uint8Array(16*r.length),n=0;for(let t of r)s.set(t,n),n+=16;let o=this._unpad(s);return(new TextDecoder).decode(o)}_bytesToHex(t){return Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("")}_hexToBytes(t){if(!/^[0-9a-fA-F]+$/.test(t))throw new Error("AetherCipher: Invalid hex string");let e=new Uint8Array(t.length/2);for(let h=0;h<t.length;h+=2)e[h/2]=parseInt(t.substr(h,2),16);return e}testVectors(){const t=[{key:"key1",plain:"Hello World!"},{key:"ðŸŒŸðŸ”¥",plain:"Creative unicode âœ“"},{key:"longkey".repeat(10),plain:"A".repeat(300)}];let h=[];for(let r of t){let t=new e(r.key),i=t.encrypt(r.plain),s=t.decrypt(i)===r.plain;h.push({key:r.key.substring(0,10)+"â€¦",plain:r.plain.substring(0,20)+"â€¦",pass:s})}return h}avalancheTest(){let t=0,e=[];for(let h=0;h<20;h++){const r=Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2);let i=Math.floor(Math.random()*r.length);let s=r.substring(0,i)+String.fromCharCode(1^r.charCodeAt(i))+r.substring(i+1);let n=this.encrypt(r),o=this.encrypt(s),l=this._hexToBytes(n),a=this._hexToBytes(o);let f=0;for(let d=0;d<l.length;d++){let u=l[d]^a[d];for(;u;)f+=1&u,u>>=1}let c=f/(8*l.length)*100;e.push(c),t+=c}let h=t/20,r=Math.min(...e),i=Math.max(...e);return console.log(`avalanche: avg=${h.toFixed(2)}% min=${r.toFixed(2)}% max=${i.toFixed(2)}%`),h}}"undefined"!=typeof window&&(window.AetherCipher=e,window.AetherHash=t),"undefined"!=typeof module&&module.exports&&(module.exports={AetherCipher:e,AetherHash:t});
